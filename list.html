<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>list</title>
    <link rel="stylesheet" href="css/list.css">
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="css/baobao.css">
</head>
<body>
    <header class="margin">
        <div class="left"><a href="index.html"><img src="http://www.bagsnet.com/images/default/20111208/7690a92fa291ff12.jpg" alt=""></a></div>
        <div class="right">
            <div class="top">
                <a href="index.html"><img src="http://www.bagsnet.com/themes/mbaobao/images/t11.gif" alt=""></a>
            </div>
            <div class="bottom">
                <div class="bt1">
                    <b class="txt1"><a href="login.html">登录</a><a href="register.html">注册</a></b>
                    <b class="txt2">欢迎<span class="dddd"></span>登录,<em id="exit">退出</em></b>
                    <a href="##">会员中心</a>
                    <a href="##">设为首页</a>
                    <a href="##">收藏</a>
                    <a href="##">帮助</a>
                </div>
                <div class="bt2">
                    <a href="car.html">我的购物车(<b class="numall">0</b>)</a>
                </div>
            </div>
        </div>
    </header>
    <nav>
        <div class="margin">
            <ul>
                <li class="te"><a href="">首页</a></li>
                <li><a href="">女包</a></li>
                <li><a href="">男包</a></li>
                <li><a href="">钱包带夹</a></li>
                <li><a href="">背包</a></li>
                <li><a href="">拉杆箱</a></li>
                <li><a href="">更多</a></li>
                <li><a href="">活动</a></li>
            </ul>
            <form action="">
                <input type="text" class="txt" value="输入货号或关键词">
                <span class="sub"></span>
            </form>
        </div>
    </nav>
    <main class="margin">
        <ul class="list1">
            <li>
                <img src="http://www.bagsnet.com/themes/mbaobao/images/qing1.gif" alt="">
                <div class="border"></div>
                <ul class="list2">
                </ul>
            </li>
            <li>
                <img src="http://www.bagsnet.com/themes/mbaobao/images/qing2.gif" alt="">
                <div class="border"></div>
                <ul class="list2">    
                </ul>
            </li>
            <li>
                <img src="http://www.bagsnet.com/themes/mbaobao/images/qing3.gif" alt="">
                <div class="border"></div>
                <ul class="list2">    
                </ul>
            </li>
            <li>
                <img src="http://www.bagsnet.com/themes/mbaobao/images/qing4.gif" alt="">
                <div class="border"></div>
                <ul class="list2">    
                </ul>
            </li>
        </ul>
    </main>
    <footer>
        <div class="margin">
            <div class="box1">
                <div class="top">139-2957-1525</div>
                <div class="bottom">留言板<a href="">点击进入</a></div>
            </div>
            <div class="box2 te">
                <h3><a href="">新手上路</a></h3>
                <ul>
                    <li><a href="">注册新用户</a></li>
                    <li><a href="">网购流程</a></li>
                    <li><a href="">会员等级服务</a></li>
                </ul>
            </div>
            <div class="box3 te">
                <h3><a href="">如何付款/退款</a></h3>
                <ul>
                    <li><a href="">支付方式</a></li>
                    <li><a href="">如何办理退款</a></li>
                </ul>
            </div>
            <div class="box4 te">
                <h3><a href="">配送方式</a></h3>
                <ul>
                    <li><a href="">配送政策</a></li>
                    <li><a href="">运费说明</a></li>
                    <li><a href="">配送查询</a></li>
                </ul>
            </div>
            <div class="box5 te">
                <h3><a href="">售后服务</a></h3>
                <ul>
                    <li><a href="">退换货政策</a></li>
                    <li><a href="">如何办理退换货</a></li>
                    <li><a href="">投诉建议</a></li>
                </ul>
            </div>
            <div class="box6 te">
                <h3><a href="">新手上路</a></h3>
            </div>
            <div class="bottom"><a href=""><img src="http://www.bagsnet.com/themes/mbaobao/images/g1.gif" alt=""></a></div>
        </div>
    </footer>
    <section id="footer" class="margin">
        <div class="top">
            <img src="http://china.bagsnet.com/newimg/xxmm-beian.gif" alt="">
            <img src="http://china.bagsnet.com/newimg/xxmm-jubao.gif" alt="">
            <img src="http://china.bagsnet.com/newimg/xxmm-xieh.gif" alt="">
        </div>
        <p>2003～2019 包包网 | BagsNet   All rights reserved</p>
        <a href="">Powered by <b style="color:#5c719e">Shop</b><b style="color:#f39000">Ex</b></a><span> v4.8.5</span>
        <a href="">粤ICP 05015913</a>
    </section>
</body>
<script src="js/jquery.js"></script>
<script src="js/ajax.2.0.js"></script>
<script src="js/cookie.js"></script>
<script>
class List{
        constructor(){
            this.list1 = document.querySelector(".list1")
            this.cont = document.querySelectorAll("main .list1 .list2");
            this.url = "http://localhost/wny-git/php/goods.json";
            this.init();
            this.add()
        }
        init(){
            var that = this;
            ajax({
                url:this.url,
                success:function(res){
                    that.res = JSON.parse(res);
                    // console.log(that.res)

                    that.display()
                }
            })
        }
        display(){
            var str = "";
            for(var i=0;i<this.res.length;i++){
                console.log(this.res[i].newprice)
                str += `<li class="wny" index="${this.res[i].goodsId}" pri="${this.res[i].newprice}">
                            <img src="${this.res[i].src}">
                            <a>${this.res[i].name}</a>
                            <p class="te">市场价：￥${this.res[i].oldprice}</p>
                            <p>销售价：￥${this.res[i].newprice}</p>
                            <em class="btn">加入购物车</em>
                        </li>`       
                }
                
            for(var i = 0;i<this.cont.length;i++){
                this.cont[i].innerHTML = str;
            }
        }
        add(){
            var that = this;
            this.list1.addEventListener("click",function(eve){
                var e = eve || window.event;
                var target = e.target || e.srcElement;
                if(target.className == "btn"){
                    that.id = target.parentNode.getAttribute("index");
                    that.pri =target.parentNode.getAttribute("pri");
                    // console.log(that.pri)
                    that.setCookie()
                }
            })
        }
        setCookie(){
				// 点击商品的情况
				// 存cookie，存什么格式的字符
					// 商品：对象		{id:,num:}
					// 所有商品：数组	[{id:,num:},{id:,num:},{id:,num:}]
				
				// 3.先获取cookie用来判断第一次还是后面的次
				this.goods = getCookie("shangpin");
				// 开始判断
				if(this.goods){
					// 5.之后点击，先解析数据
					// console.log(this.goods);
					// console.log(JSON.parse(this.goods));
					this.goods = JSON.parse(this.goods);
					
					// 6.判断点的是否是重复数据
					var onoff = true;
					
					for(var i=0;i<this.goods.length;i++){
						if(this.goods[i].id == this.id){
							// 是重复数据
							this.goods[i].num ++;
							onoff = false;
						}
					}
					// 7.点的是新数据
					if(onoff){
						this.goods.push({
							id:this.id,
                            num:1,
                            money:this.pri
						})
                    }
                    
				}else{
					// 4.第一次点击，直接存
					this.goods = [{
						id:this.id,
                        num:1,
                        money:this.pri
					}]
				}
				// 8.以上都只是在操作数组，最后要设置回cookie
				setCookie("shangpin",JSON.stringify(this.goods))
			}
    }
    new List;
    
</script>
</html>