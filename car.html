<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>car</title>
    <link rel="stylesheet" href="css/car.css">
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="css/baobao.css">
</head>
<body>
    <header class="margin">
        <div class="left"><a href="index.html"><img src="http://www.bagsnet.com/images/default/20111208/7690a92fa291ff12.jpg" alt=""></a></div>
        <div class="right">
            <div class="top">
                <a href="index.html"><img src="http://www.bagsnet.com/themes/mbaobao/images/t11.gif" alt=""></a>
            </div>
            <div class="bottom">
                <div class="bt1">
                    <b class="txt1"><a href="login.html">登录</a><a href="register.html">注册</a></b>
                    <b class="txt2">欢迎<span class="dddd"></span>登录,<em id="exit">退出</em></b>
                    <a href="##">会员中心</a>
                    <a href="##">设为首页</a>
                    <a href="##">收藏</a>
                    <a href="##">帮助</a>
                </div>
                <div class="bt2">
                    <a href="car.html">我的购物车(<b class="numall">0</b>)</a>
                </div>
            </div>
        </div>
    </header>
    <nav>
        <div class="margin">
            <ul>
                <li><a href="index.html">首页</a></li>
                <li><a href="">女包</a></li>
                <li><a href="">男包</a></li>
                <li><a href="">钱包带夹</a></li>
                <li><a href="">背包</a></li>
                <li><a href="">拉杆箱</a></li>
                <li><a href="">更多</a></li>
                <li><a href="">活动</a></li>
            </ul>
            <form action="">
                <input type="text" class="txt" value="输入货号或关键词">
                <span class="sub"></span>
            </form>
        </div>
    </nav>
    <main class="margin">
        <div class="top clear">
            <a href="index.html"><img src="http://www.bagsnet.com/images//20190218/760126b68a2d337a.jpg" alt=""></a>
            <a href="##"><img src="http://www.bagsnet.com/images//20190218/897f781fda731bf3.jpg" alt=""></a>
            <a href="index.html"><img src="http://www.bagsnet.com/images//20170303/ff81aa19e041f970.gif" alt=""></a>
        </div>
        <div class="car">
            <h3>购物车目前有(<b class="numall">0</b>)件商品</h3>
            <p><a href="list.html">继续挑选商品》》</a></p>
        </div>
        <table border="1" cellspacing="0" width="800" align="center" class="tab">
            <thead>
                <tr>
                    <th>选中</th>
                    <th>图片</th>
                    <th>名字</th>
                    <th>价格</th>
                    <th>数量</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <!-- <tr>
                    <td><input type="cheackbox"></td>
                    <td><img src="" alt=""></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td><span>删除</span></td>
                </tr> -->
            </tbody>
        </table>
    </main>
    <footer>
        <div class="margin">
            <div class="box1">
                <div class="top">139-2957-1525</div>
                <div class="bottom">留言板<a href="">点击进入</a></div>
            </div>
            <div class="box2 te">
                <h3><a href="">新手上路</a></h3>
                <ul>
                    <li><a href="">注册新用户</a></li>
                    <li><a href="">网购流程</a></li>
                    <li><a href="">会员等级服务</a></li>
                </ul>
            </div>
            <div class="box3 te">
                <h3><a href="">如何付款/退款</a></h3>
                <ul>
                    <li><a href="">支付方式</a></li>
                    <li><a href="">如何办理退款</a></li>
                </ul>
            </div>
            <div class="box4 te">
                <h3><a href="">配送方式</a></h3>
                <ul>
                    <li><a href="">配送政策</a></li>
                    <li><a href="">运费说明</a></li>
                    <li><a href="">配送查询</a></li>
                </ul>
            </div>
            <div class="box5 te">
                <h3><a href="">售后服务</a></h3>
                <ul>
                    <li><a href="">退换货政策</a></li>
                    <li><a href="">如何办理退换货</a></li>
                    <li><a href="">投诉建议</a></li>
                </ul>
            </div>
            <div class="box6 te">
                <h3><a href="">新手上路</a></h3>
            </div>
            <div class="bottom"><a href=""><img src="http://www.bagsnet.com/themes/mbaobao/images/g1.gif" alt=""></a></div>
        </div>
    </footer>
    <section id="footer" class="margin">
        <div class="top">
            <img src="http://china.bagsnet.com/newimg/xxmm-beian.gif" alt="">
            <img src="http://china.bagsnet.com/newimg/xxmm-jubao.gif" alt="">
            <img src="http://china.bagsnet.com/newimg/xxmm-xieh.gif" alt="">
        </div>
        <p>2003～2019 包包网 | BagsNet   All rights reserved</p>
        <a href="">Powered by <b style="color:#5c719e">Shop</b><b style="color:#f39000">Ex</b></a><span> v4.8.5</span>
        <a href="">粤ICP 05015913</a>
    </section>
</body>
<script src="js/jquery.js"></script>
<script src="js/ajax.2.0.js"></script>
<script src="js/cookie.js"></script>
<script src="js/public.js"></script>
<script>
    class Car{
        constructor(){
            this.table = document.querySelector("table")
            this.tbody = document.querySelector("tbody");
            this.url = "http://localhost/wny-git/php/goods.json";
            this.downs = document.querySelectorAll(".down"); //一组减的按钮 
            this.ups = document.querySelectorAll(".up"); //一组加的按钮 
            this.dels = document.querySelectorAll(".del"); //一组删除按钮 
            this.init();
            this.remove1();
            this.tab = document.querySelector(".tab");
            this.numall1 = document.querySelectorAll(".numall")[0];
            this.numall2 = document.querySelectorAll(".numall")[1];
            // console.log(this.numall1)
            // console.log(this.numall2)
        }
        init(){
            var that = this;
            ajax({
                url:this.url,
                success:function(res){
                    that.res = JSON.parse(res);
                    // console.log(that.res);
                    that.getcookie();
                }
            })
        }
        getcookie(){
            if(getCookie("shangpin") !=undefined){
                this.table.style.display = "block"
                this.goods = JSON.parse(getCookie("shangpin"));
                this.display();   
            }else{
                this.table.style.display = "none"
            }
        }
        display(){
            // var that = this;
            // console.log(this.res);
            // console.log(this.goods);
            var str = "";
            var pri=0;
            var numqu=0;
            for(var i=0;i<this.res.length;i++){
                for(var j=0;j<this.goods.length;j++){
                    if(this.res[i].goodsId == this.goods[j].id){
                        str += `<tr index="${this.goods[j].id}">
                                    <td><input type="checkbox"></td>
                                    <td><img src="${this.res[i].src}"></td>
                                    <td>${this.res[i].name}</td>
                                    <td>${this.res[i].newprice}</td>
                                    <td><input type="number" value="${this.goods[j].num}" min=1></td>
                                    <td><button class="del">删除</button></td>
                                </tr>`
                        pri +=this.goods[j].num*this.res[i].newprice;
                        numqu+= (this.goods[j].num*1)
                        // console.log(this.goods[i].num)
                        // console.log(this.res[i].num*this.res[i].price);
            
                        // console.log(arr1)
                    }
                    // console.log(this.dels)
                }
            }
            this.pri = pri ;
            var arr = str + `<tr>
                                <td><span>全选</span></td>
                                <td></td>
                                <td></td>
                                <td><span>总价</span></td>
                                <td>${this.pri}</td>
                                <td><span>结账</span></td>
                            </tr>`
            this.tbody.innerHTML = arr;
            this.numall1.innerHTML = numqu;
            this.numall2.innerHTML = numqu;
        }
        remove1(){
            var that = this;
            this.tbody.addEventListener("click",function(eve){
                var e = event||window.event;
                
                if(e.target.className =="del"){
                    that.id=eve.target.parentNode.parentNode.getAttribute("index");
                    e.target.parentNode.parentNode.remove();
                    that.changeCookie(function(i){
                        that.goods.splice(i,1);
                    })
                }
            })
            this.tbody.addEventListener("input",function(eve){
                
                var e = event||window.event;
                
                if(e.target.type =="number"){
                    that.id=eve.target.parentNode.parentNode.getAttribute("index");
                    that.changeCookie(function(i){
                        that.goods[i].num=e.target.value;
                        
                        // console.log(e.target.value)
                    })
                }
            })
        }
        changeCookie(callback){
            var all = [];
            
            var str=0;
            for(var i = 0;i<this.goods.length;i++){
                if(this.goods[i].id ==this.id){
                    callback(i);
                    // break;
                }
                // console.log(this.goods[i])
                all.push(this.goods[i].money * this.goods[i].num);
                str+=(this.goods[i].num*1);
                
            }
                // console.log(all);
                this.xianshi(all)
                // console.log(str)
            // console.log(this.goods)
            setCookie("shangpin",JSON.stringify(this.goods));
            this.numall1.innerHTML = str;
            this.numall2.innerHTML = str;
        }
        xianshi(all2){
            var allmoney = 0;
            // console.log(all2)
            for(var i = 0;i<all2.length;i++){
                allmoney += all2[i];
            }
            // console.log(allmoney)
            this.tbody.lastElementChild.lastElementChild.previousElementSibling.innerHTML = "";
            this.tbody.lastElementChild.lastElementChild.previousElementSibling.innerHTML = allmoney;
        }
    }
    new Car;
</script>
</html>